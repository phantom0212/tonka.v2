function apAutloadTemplate(a){return"undefined"!=typeof a.disableAutoLoad&&a.disableAutoLoad}var apObjectWatching={},apData={};!function(a){apFunctions={},a(function(){AnsPress.site=new AnsPress.site,AnsPress.site.initialize()}),window.AnsPress={},AnsPress.site=function(){},AnsPress.site.prototype={initialize:function(){ApSite=this,this.ajax_id=new Object,this.loading=new Object,this.errors,this.ajaxData,this.appendFormError(),this.appendMessageBox(),this.ajaxBtn(),this.saveComment(),this.afterPostingAnswer(),this.ap_ajax_form(),this.deleteComment(),this.editComment(),this.vote(),this.select_answer(),this.ap_delete_post(),this.ap_upload_field(),this.avatarUploadCallback(),this.load_profile_field(),this.ap_post_upload_field(),this.tinyMCEeditorToggle(),this.tab(),this.set_featured(),this.modal(),this.expand(),this.follow(),this.updateCover(),this.hoverCard(),this.delete_notification(),this.mark_as_read(),this.cancel_comment(),this.questionSuggestion(),this.checkboxUncheck(),this.listFilter()},doAjax:function(b,c,d,e,f){d=d||!1,c=c||!1,e=e||!1,f=f||!1;var g=apGetValueFromStr(b,"ap_ajax_action");f&&"undefined"!=typeof ApSite.ajax_id[g]&&ApSite.ajax_id[g].abort();var h=a.ajax({type:"POST",url:ajaxurl,data:b,beforeSend:function(){d&&ApSite.showLoading(d),"function"==typeof e&&e()},success:function(b){ApSite.hideLoading(d);var e=apParseAjaxResponse(b);"function"==typeof c&&(b=a.isEmptyObject(e)?b:e,c(b,d))},context:d,cache:!1});return ApSite.ajax_id[g]=h,h},doAction:function(b){var c=this,b="undefined"!=typeof b?'[data-action="'+b+'"]':"[data-action]",d=new Object;a(b).each(function(b){var e=a(this).attr("data-action");"undefined"==typeof d[e]&&(d[e]="1",c[e]('[data-action="'+e+'"]'))})},uniqueId:function(){return a(".ap-uid").length},showLoading:function(b){AnsPress.site.hideLoading(b);var c=a(b).data("loadclass")||"",d=this.uniqueId(),e=a('<div class="ap-loading-icon ap-uid '+c+'" id="apuid-'+d+'"><i class="apicon-sync"><i></div>');a("body").append(e);var f=a(b).offset(),g=a(b).outerHeight(),h=a(b).outerWidth();return e.css({top:f.top,left:f.left,height:g,width:h}),a(b).data("loading","#apuid-"+d),"#apuid-"+d},hideLoading:function(b){"all"==b?a(".ap-loading-icon").hide():a(a(b).data("loading")).hide()},ap_ajax_form:function(){a("body").delegate('[data-action="ap_ajax_form"]',"submit",function(){if(AnsPress.site.showLoading(this),ApSite.clearFormErrors(a(this).attr("id")),a(this).is("[data-before]")){var b=a(this).data("before");if("function"==typeof ApSite[b]&&!1===ApSite[b](this))return!1}return a(this).append('<input type="hidden" name="ap_ajax_action" value="'+a(this).attr("name")+'">'),a(this).append('<input type="hidden" name="action" value="ap_ajax">'),"undefined"!=typeof tinyMCE&&tinyMCE.triggerSave(),a(this).ajaxSubmit({type:"POST",url:ajaxurl,success:function(a){AnsPress.site.hideLoading(this),"undefined"!=typeof tinyMCE&&"undefined"!=typeof a.type&&"success"==a.type&&tinyMCE.activeEditor.setContent("")},error:function(a,b,c){console.log(c),AnsPress.site.hideLoading(this)},dataType:"html",context:this,global:!0,cache:!1}),!1})},appendFormError:function(){a(document).on("ap_after_ajax",function(b,c){"undefined"!=typeof c&&"undefined"!=typeof c.errors&&(ApSite.clearFormErrors(c.form),a.each(c.errors,function(b,d){var e=a("#"+c.form).find("#"+b).closest(".ap-form-fields");e.addClass("ap-have-error"),ApSite.helpBlock(e,d)}))})},helpBlock:function(b,c){a(b).find(".ap-form-error-message").length>0&&a(b).find(".ap-form-error-message").remove(),a(b).append('<p class="ap-form-error-message">'+c+"</p>")},clearFormErrors:function(b){var c=a("#"+b).find(".ap-have-error");c.find(".ap-form-error-message").remove(),c.removeClass("ap-have-error")},appendMessageBox:function(){"0"==a("#ap-notify").length&&a("body").append('<div id="ap-notify"></div>')},addMessage:function(b,c){var d=aplang[c];a('<div class="ap-notify-item '+c+'"><i class="'+d+'"></i><div class="ap-notify-content">'+b+"</div></div>").appendTo("#ap-notify").animate({"margin-left":0},500).delay(2e3).fadeOut(200)},redirect:function(a){"undefined"!=typeof a&&window.location.replace(a)},reload:function(a){location.reload()},append:function(b){"undefined"!=typeof b.container&&a(b.container).append(b.html)},updateText:function(b,c){""!=c&&a(b).text(c)},replaceWith:function(b,c){a(b).replaceWith(c)},updateHtml:function(b,c){"undefined"!=typeof c.html&&a(b).html(c.html)},toggle_active_class:function(b,c){"undefined"!=typeof b&&(a(b).find("li").removeClass("active"),a(b).find(c).addClass("active"),a(b).toggleClass("active"))},removeClass:function(b,c){a(b).length>0&&a(b).removeClass(c)},addClass:function(b,c,d){b="context"===b?d:b,a(b).length>0&&a(b).addClass(c)},append_before:function(b,c){"undefined"!=typeof b&&a(b).before(c.html)},remove_if_exists:function(b,c,d){console.log(d),b="context"===b?d:b,"undefined"!=typeof b&&a(b).length>0&&a(b).remove()},clearForm:function(a){"undefined"!=typeof tinyMCE&&tinyMCE.activeEditor.setContent("")},scrollToCommentForm:function(){a("#ap-commentform").length>0&&a("html, body").animate({scrollTop:a("#ap-commentform").offset().top-150},500)},ajaxBtn:function(){a("body").delegate('[data-action="ajax_btn"]',"click",function(b){if(!a(this).is(".ajax-disabled")){b.preventDefault();var c=a(this).apAjaxQueryString();ApSite.doAjax(c,function(b,c){if(a(c).data("cb")){var d=a(c).data("cb");console.log(apFunctions[d]),"function"==typeof apFunctions[d]&&apFunctions[d](b,c)}},this)}})},saveComment:function(){a("body").delegate("#ap-commentform","submit",function(){"undefined"!=typeof tinyMCE&&tinyMCE.triggerSave();var b=a(this);return ApSite.doAjax(apAjaxData(b.formSerialize()),function(b){ApSite.hideLoading(this),apData[b.key]=b.apData,a('a[href="#comments-'+b.comment_post_ID+'"]').removeClass("loaded")},this),!1})},deleteComment:function(){a("body").delegate('[data-action="deleteComment"]',"click",function(b){b.preventDefault();var c=a(this),d=c.attr("data-query");ApSite.doAjax(apAjaxData(d),function(a){apData[a.key]=a.apData},this,!1,!0)})},editComment:function(){a("body").delegate('[data-action="editComment"]',"click",function(b){b.preventDefault();var c=a(this),d=c.attr("data-query");ApSite.doAjax(apAjaxData(d),function(a){},this,!1,!0)})},ap_subscribe:function(){a('[data-action="ap_subscribe"]').click(function(b){b.preventDefault();var c=a(this).attr("data-query");ApSite.doAjax(apAjaxData(c),function(b){AnsPress.site.hideLoading(this),"subscribed"==b.action?(a(this).addClass("active"),a(this).closest(".ap-subscribe").addClass("active")):(a(this).removeClass("active"),a(this).closest(".ap-subscribe").removeClass("active"))},this,function(){a(this).closest(".ap-subscribe").toggleClass("active")})})},vote:function(){a("body").delegate('[data-action="vote"] a',"click",function(b){b.preventDefault();var c=a(this).attr("data-query"),d=a(this);ApSite.doAjax(apAjaxData(c),function(a){var b=d.parent();b.find(".ap-vote-fade").remove(),("undefined"!=typeof a.action&&"voted"==a.action||"undo"==a.action)&&("voted"==a.action?(d.addClass("voted"),"vote_up"==a.type&&b.find(".vote-down").addClass("disable"),"vote_down"==a.type&&b.find(".vote-up").addClass("disable"),d.trigger("voted",a)):"undo"==a.action&&(d.removeClass("voted"),"vote_up"==a.type&&b.find(".vote-down").removeClass("disable"),"vote_down"==a.type&&b.find(".vote-up").removeClass("disable"),d.trigger("undo_vote",a)),b.find(".net-vote-count").text(a.count))},this,!1)})},afterPostingAnswer:function(){a(document).on("ap_after_ajax",function(b,c){"undefined"!=typeof c&&"undefined"!=typeof c.action&&"new_answer"==c.action&&(a("#description").val(""),0===a("#answers").length?(a("#question").after(a(c.html)),a(c.div_id).hide(),a(c.div_id).slideDown(500)):(a("#answers").append(a(c.html).hide()),a(c.div_id).slideDown(500)))})},select_answer:function(){a("body").delegate('[data-action="select_answer"]',"click",function(b){b.preventDefault();var c=a(this).attr("data-query");ApSite.doAjax(apAjaxData(c),!1,this)})},ap_delete_post:function(){a("#anspress").delegate('[data-action="ap_delete_post"]',"click",function(b){b.preventDefault();var c=a(this).attr("data-query");ApSite.doAjax(apAjaxData(c),function(b){"undefined"!=typeof b.action&&"delete_answer"==b.action&&a(b.div_id).slideUp(500).fadeOut(300,function(){a(this).remove()})},this,!1)})},ap_upload_field:function(){a('[data-action="ap_upload_field"]').change(function(){a(this).closest("form").submit()}),a('[data-action="ap_upload_form"]').submit(function(){var b=this;return a(this).ajaxSubmit({success:function(b){b=a(b),b=JSON.parse(b.filter("#ap-response").html()),a("body").trigger("uploadForm",[b,this])},url:ajaxurl,context:b}),!1})},avatarUploadCallback:function(){a(document).on("uploadForm",function(b,c,d){if("undefined"!=typeof c.action&&"avatar_uploaded"===c.action){var e=a(c.html).attr("src");a(d).prev().attr("src",e)}})},load_profile_field:function(){a("body").delegate('[data-action="ap_load_user_field_form"]',"click",function(b){b.preventDefault();var c=a(this).attr("data-query");ApSite.doAjax(apAjaxData(c),function(a){AnsPress.site.hideLoading(this)},this,!1)})},ap_post_upload_field:function(){a("body").on("click",'[data-action="ap_post_upload_field"]',function(b){b.preventDefault(),a('input[name="post_upload_image"]').trigger("click")}),a("body").delegate('[name="post_upload_image"]',"change",function(b){a("#hidden-post-upload").submit()}),a("body").delegate("#hidden-post-upload","submit",function(){var b=a('[data-action="ap_post_upload_field"]').closest(".ap-upload-o");return a(this).ajaxSubmit({beforeSubmit:function(){ApSite.showLoading(b)},success:function(c){if(ApSite.hideLoading(b),c=a(c),c=JSON.parse(c.filter("#ap-response").html()),a("body").trigger("postUploadForm",c),"undefined"!=typeof c.url){if(c.mime.indexOf("image")>-1){var d='<img src="'+c.url+'" />';ApSite.addImageInEditor(d)}var d='<span id="'+c.attachment_id+'"><i class="apicon-cloud-upload"></i><a href="'+c.url+'">'+c.name+'</a><i class="close" data-action="ajax_btn" data-query="delete_attachment::'+ap_nonce+"::"+c.attachment_id+'">&times;</i></span>';a(d).appendTo("#ap-upload-list"),a(".ap-post-upload-form").append('<input type="hidden" name="attachment_ids[]" value="'+c.attachment_id+'" />')}},url:ajaxurl,type:"POST"}),!1}),a("body").delegate('.ap-upload-remote-link, [data-action="post_image_close"]',"click",function(b){b.preventDefault(),a(".ap-upload-link-rc").toggle()}),a("body").delegate('[data-action="post_image_ok"]',"click",function(b){b.preventDefault(),a(".ap-upload-link-rc").toggle(),""!=a(this).prev().val()&&ApSite.addImageInEditor('<img src="'+a(this).prev().val()+'" />')})},addImageInEditor:function(b){"undefined"!=typeof tinyMCE?tinyMCE.activeEditor.execCommand("mceInsertContent",!1,b):a(".wp-editor-area").val(a(".wp-editor-area").val()+b)},previewLocalImage:function(a){if(a.files&&a.files[0]){var b=new FileReader;b.onload=function(a){ApSite.addImageInEditor('<img src="'+a.target.result+'" />')},b.readAsDataURL(a.files[0])}},tinyMCEeditorToggle:function(){a("body").delegate('[data-action="ap_fullscreen_toggle"]',"click",function(b){b.preventDefault(),a(this).toggleClass("active"),tinyMCE.activeEditor.execCommand("mceFullscreen")})},tab:function(){a("body").delegate(".ap-tab-nav a","click",function(b){b.preventDefault();var c=a(this).attr("href");a(".ap-tab-container > *").removeClass("active"),a(".ap-tab-nav >li").removeClass("active"),a(this).parent().addClass("active"),a(c).toggleClass("active")})},set_featured:function(){a("body").delegate('[data-action="set_featured"]',"click",function(b){b.preventDefault();var c=(a(this).closest("ul").prev(),a(this).attr("data-query"));ApSite.doAjax(apAjaxData(c),function(a){},this,!1,!0)})},modal:function(){a("body").delegate('[data-action="ap_modal"]',"click",function(b){b.preventDefault();var c=a(a(this).data("toggle"));c.addClass("open");var d=c.find(".ap-modal-inner"),e=d.width(),f=d.height(),g=a(window).width(),h=a(window).height();d.css({left:(g-e)/2,top:h/2-f/2})}),a("body").delegate('[data-action="ap_modal_close"]',"click",function(b){a(".ap-modal").removeClass("open")})},expand:function(){a("body").delegate('[data-action="ap_expand"]',"click",function(b){b.preventDefault();var c=a(this).data("expand"),d=a(c).parent();a(d).animate({height:a(c).height()}),a(this).hide()})},follow:function(){a("body").delegate('[data-action="ap_follow"]',"click",function(b){b.preventDefault();var c=a(this).attr("data-query");ApSite.doAjax(apAjaxData(c),function(b){AnsPress.site.hideLoading(this),"follow"==b.action?a(this).addClass("active"):a(this).removeClass("active")},this,function(){a(this).toggleClass("active")})})},updateCover:function(){a(document).on("uploadForm",function(b,c){"undefined"!=typeof c.action&&"cover_uploaded"===c.action&&a('[data-view="user_cover_'+c.user_id+'"]').css({"background-image":"url("+c.image+")"})})},hoverCard:function(){disable_hover_card||a("[data-userid], [data-catid]").aptip({theme:"ap-hover-card",interactive:!0,delay:500,position:"bottom right",title:'<div class="hovercard-loading-bg"></div>'})},delete_notification:function(){a("body").delegate('[data-action="ap_delete_notification"]',"click",function(b){b.preventDefault();var c=a(this).attr("data-query");ApSite.doAjax(apAjaxData(c),function(b){AnsPress.site.hideLoading(this),"undefined"!=typeof b.container&&a(b.container).slideUp("400",function(){a(b.container).remove()})},this)})},mark_as_read:function(){a("body").delegate('[data-action="ap_markread_notification"]',"click",function(b){b.preventDefault();var c=a(this).attr("data-query");ApSite.doAjax(apAjaxData(c),function(a){AnsPress.site.hideLoading(this)},this)}),a(document).on("ap_after_ajax",function(b,c){"undefined"!=typeof c.action&&("mark_read_notification"===c.action?(a(c.container).removeClass("unread"),a(c.container).find(".ap-btn-markread").remove()):"mark_all_read"===c.action&&(a(".ap-notification-item").removeClass("unread"),a(".ap-notification-item").find(".ap-btn-markread").remove()))})},cancel_comment:function(){a("body").delegate('[data-action="cancel-comment"]',"click",function(b){b.preventDefault();var c=a(this).data("id");a('[href="#comments-'+c+'"]').removeClass("loaded"),a(this).closest(".ap-comment-form").remove()})},questionSuggestion:function(){if(!disable_q_suggestion){var b=null;a('[data-action="suggest_similar_questions"]').on("keyup",function(){var c=a(this).val(),d=this;0!=c.length&&(null!=b&&clearTimeout(b),b=setTimeout(function(){b=null,ApSite.doAjax(apAjaxData("action=ap_ajax&ap_ajax_action=suggest_similar_questions&ap_ajax_nonce="+ap_nonce+"&value="+c),function(b){console.log(b),a("#similar_suggestions").html(b.html)},d,!1,!0)},500))})}},notificationAsRead:function(){},checkboxUncheck:function(){a('#anspress input[type="checkbox"]').click(function(){var b=a(this).attr("name");a(this).is(":checked")?a('input[name="'+b+'"][type="hidden"]').attr("name","_hidden_"+b):a('input[name="_hidden_'+b+'"]').attr("name",b)})},listFilter:function(){a("body").delegate('[data-action="load_filter"]',"click",function(b){if(!a(this).is(".ajax-disabled")){b.preventDefault();var c=a(this).apAjaxQueryString();c.current_filter=a("#current_filter").html(),ApSite.doAjax(c,function(b,c){if(a(c).data("cb")){var d=a(c).data("cb");console.log(apFunctions[d]),"function"==typeof apFunctions[d]&&apFunctions[d](b,c)}},this)}}),a("body").delegate("#ap-filter .ap-dropdown-menu a","click",function(b){b.preventDefault();var c=a(this).closest(".ap-dropdown-menu"),d=c.data("key"),e=a(this).data("value")||!1;if(e){var f=c.data("multiple");f?c.find('input[name="ap_filter['+d+'][]"][value="'+e+'"]').length>0?c.find('input[name="ap_filter['+d+'][]"][value="'+e+'"]').remove():c.append('<input value="'+e+'" type="hidden" name="ap_filter['+d+'][]" />'):c.find('input[type="hidden"]').val(e),a(this).closest("form").submit()}}),a("body").delegate("#ap-question-sorting-reset","click",function(b){b.preventDefault(),a("#ap-filters").find('input[type="hidden"]').val(""),a(this).closest("form").submit()});var b=0;a("body").delegate(".ap-filter-search","keyup",function(c){var d=a(this).val();a(this).data("query","filter_search::"+ap_nonce+"::"+d);var e=(a(this).apAjaxQueryString(),a(this).closest(".ap-dropdown-menu").data("key"));clearTimeout(b),b=setTimeout(function(){a.ajax({url:ajaxurl,type:"POST",data:{action:"ap_ajax",ap_ajax_action:"filter_search",__nonce:ap_nonce,val:d,filter:e},success:function(a){a=apParseAjaxResponse(a),a.apData&&apMergeObj(apData[e+"Filter"],a.apData)}})},500)}),a("body").delegate("#ap-question-sorting","submit",function(){AnsPress.site.showLoading(this);var b=a(this).serialize().replace(/[^&]+=&/g,"").replace(/&[^&]+=$/g,"");return a.ajax({type:"GET",dataType:"html",data:b,success:function(c){AnsPress.site.hideLoading("#ap-question-sorting");var d=a(c);window.history.replaceState("","","?"+b),a("#anspress").html(d.find("#anspress")),a(document).trigger("apAfterSorting")}}),!1})}}}(jQuery),function(a){function b(a,b,c,d){c=c||"",d=d||"","function"==typeof ApSite[a]&&("object"==typeof b?(b.push(d),ApSite[a].apply(ApSite,b)):ApSite[a](b,c,d))}a(document).ajaxComplete(function(c,d,e){var f=apParseAjaxResponse(d.responseText);if(!a.isEmptyObject(f)){if(console.log(f),f.apTemplate&&"object"==typeof f.apTemplate&&!apAutloadTemplate(f)&&apLoadTemplate(f.apTemplate.name,f.apTemplate.template,function(b){if(f.apData&&f.key){var c="undefined"==typeof apData[f.key];apData[f.key]=f.apData;var d=function(){console.log(f.key+" changed");var c=a(Ta.render(b,apData[f.key]));a(apObjectWatching[f.key]).replaceWith(c),apLaodAvatar(),apObjectWatching[f.key]=c.apGetSelector()};if("undefined"==typeof apObjectWatching[f.key]&&c){console.log("Watching object "+f.key+" for change."),watch(apData,f.key,d),apObjectWatching[f.key]=!0;var e=a(Ta.render(b,f.apData));a(f.appendTo).append(e),apLaodAvatar(),apObjectWatching[f.key]=e.apGetSelector()}}}),"undefined"!=typeof f.message_type&&(""!=f.message_type&&""!=f.message&&ApSite.addMessage(f.message,f.message_type),"undefined"!=typeof grecaptcha&&"success"!==f.message_type&&grecaptcha.reset(widgetId1),a(document).trigger("ap_after_ajax",f),AnsPress.site.hideLoading("all")),"undefined"!=typeof f["do"]){var g=f["do"];"object"==typeof g?a.each(g,function(c,d){"function"==typeof ApSite[c]?b(c,d,f,e.context):"object"==typeof d&&a.each(d,function(a,c){"undefined"!=typeof c.action&&"function"==typeof ApSite[c.action]&&b(c.action,c.args,f,e.context)})}):"function"==typeof ApSite[g]&&ApSite[g](f,e.context)}"undefined"!=typeof f&&"undefined"!=typeof f.is_ap_ajax&&"undefined"!=typeof f.view&&a.each(f.view,function(b,c){try{var d=a(c)}catch(e){}"undefined"!=typeof f.view_html&&"undefined"!=typeof d&&d.is('[data-view="'+b+'"]')?(d=d.children(),a('[data-view="'+b+'"]').html(d)):(a('[data-view="'+b+'"]').text(c),a('[data-view="'+b+'"]').removeClass("ap-view-count-0"))})}})}(jQuery);